# FakeSystemVersion

FakeSystemVersion æ˜¯ä¸€ä¸ªç”¨äºŽ macOS çš„åŠ¨æ€åº“ï¼Œå®ƒå…è®¸ç”¨æˆ·åŠ¨æ€åœ°ä¿®æ”¹åº”ç”¨ç¨‹åºèŽ·å–åˆ°çš„ç³»ç»Ÿç‰ˆæœ¬ã€å†…æ ¸ç‰ˆæœ¬ä»¥åŠç¡¬ä»¶ä¿¡æ¯ã€‚é€šè¿‡ `DYLD_INSERT_LIBRARIES` æœºåˆ¶ï¼Œå®ƒå¯ä»¥åœ¨ä¸ä¿®æ”¹ç›®æ ‡åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œæ‹¦æˆªå¹¶ä¼ªé€ ç³»ç»Ÿè°ƒç”¨å’Œ Objective-C æ–¹æ³•çš„è¿”å›žå€¼ï¼Œä»Žè€Œå®žçŽ°å¯¹ç³»ç»Ÿä¿¡æ¯çš„â€œæ¬ºéª—â€ã€‚

è¿™å¯¹äºŽåœ¨ç‰¹å®šç³»ç»Ÿç‰ˆæœ¬çš„åº”ç”¨å…¼å®¹æ€§æµ‹è¯•ã€è½¯ä»¶è¡Œä¸ºåˆ†æžæˆ–ç»•è¿‡æŸäº›åº”ç”¨çš„å¼ºåˆ¶æ›´æ–°é™åˆ¶ç­‰åœºæ™¯éžå¸¸æœ‰ç”¨ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

* **å…¨é¢çš„ä¿¡æ¯ä¼ªé€ **:
    * **Cocoa/Foundation å±‚**: æ‹¦æˆª `NSProcessInfo` çš„ `operatingSystemVersion` å’Œ `operatingSystemVersionString` æ–¹æ³•ã€‚
    * **BSD/sysctl å±‚**: æ‹¦æˆª `sysctl` å’Œ `sysctlbyname` è°ƒç”¨ï¼Œä¼ªé€  `kern.osproductversion`, `kern.osbuildversion`, `kern.osrelease` ç­‰å†…æ ¸ä¿¡æ¯ï¼Œä»¥åŠ `hw.model`, `hw.machine`, `hw.memsize` ç­‰ç¡¬ä»¶ä¿¡æ¯ã€‚
    * **uname**: æ‹¦æˆª `uname()` ç³»ç»Ÿè°ƒç”¨ï¼Œä¿®æ”¹ Darwin å†…æ ¸ç‰ˆæœ¬ (`release`, `version`) å’Œæœºå™¨æž¶æž„ (`machine`)ã€‚
    * **é…ç½®æ–‡ä»¶**: æ‹¦æˆªå¯¹ `/System/Library/CoreServices/SystemVersion.plist` æ–‡ä»¶çš„è¯»å–ï¼Œè¿”å›žä¼ªé€ çš„ç‰ˆæœ¬ä¿¡æ¯å­—å…¸ã€‚
* **é«˜åº¦å¯é…ç½®**:
    * é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æˆ–çŽ¯å¢ƒå˜é‡ï¼Œå¯ä»¥è½»æ¾è®¾ç½®ä¸»ã€æ¬¡ã€è¡¥ä¸ç‰ˆæœ¬å·ï¼Œä»¥åŠç³»ç»Ÿæž„å»ºç‰ˆæœ¬å·ã€‚
    * æ”¯æŒè‡ªå®šä¹‰ Darwin å†…æ ¸ç‰ˆæœ¬å­—ç¬¦ä¸²å’Œç¡¬ä»¶ä¿¡æ¯ï¼ˆå¦‚åž‹å·ã€æž¶æž„ã€å†…å­˜å¤§å°ï¼‰ã€‚
    * å¯åˆ‡æ¢æ—¥å¿—è¾“å‡ºï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚
* **æ™ºèƒ½äº§å“åç§°**: å¯æ ¹æ®è®¾ç½®çš„ç³»ç»Ÿä¸»ç‰ˆæœ¬å·è‡ªåŠ¨åˆ¤æ–­äº§å“åç§°æ˜¯ "macOS" (>= 11) è¿˜æ˜¯ "Mac OS X" (< 11)ã€‚
* **æ˜“äºŽä½¿ç”¨**: æä¾› `cli.sh` å‘½ä»¤è¡Œå·¥å…·ï¼Œç®€åŒ–äº†çŽ¯å¢ƒå˜é‡çš„è®¾ç½®å’Œç›®æ ‡ç¨‹åºçš„å¯åŠ¨è¿‡ç¨‹ã€‚

## ðŸ› ï¸ å¦‚ä½•ç¼–è¯‘

ä½ éœ€è¦ä¸€ä¸ªæ”¯æŒ C++17 çš„ç¼–è¯‘å™¨ï¼ˆå¦‚ç³»ç»Ÿè‡ªå¸¦çš„ clang++ï¼‰ã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘åŠ¨æ€åº“ï¼š

```bash
clang++ -std=c++17 -dynamiclib fake_system_version.mm -o fake_system_version.dylib \
    -framework Foundation -fobjc-arc
```

## ðŸš€ ä½¿ç”¨æ–¹æ³•

é¡¹ç›®æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„å‘½ä»¤è¡Œè„šæœ¬ `cli.sh` æ¥åŠ è½½åŠ¨æ€åº“å¹¶æ‰§è¡Œä½ çš„ç›®æ ‡ç¨‹åºã€‚

### åŸºæœ¬ç”¨æ³•

æœ€ç®€å•çš„ç”¨æ³•æ˜¯æŒ‡å®šä¸€ä¸ªä¼ªé€ çš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œç„¶åŽ `--` åŽé¢è·Ÿä¸Šä½ è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

ä¾‹å¦‚ï¼Œè®© `sw_vers` å‘½ä»¤æ˜¾ç¤ºä¸€ä¸ªä¼ªé€ çš„ç³»ç»Ÿç‰ˆæœ¬ `15.4.1`ï¼š

```bash
./cli.sh --os-version 15.4.1 -- sw_vers
```

### é«˜çº§ç”¨æ³•

ä½ å¯ä»¥é€šè¿‡å„ç§å‚æ•°è¯¦ç»†åœ°é…ç½®ä¼ªé€ çš„ç³»ç»Ÿå’Œç¡¬ä»¶ä¿¡æ¯ã€‚

```bash
./cli.sh \
--os-version 15.4.1 \
--os-major 15 \
--os-minor 4 \
--os-patch 1 \
--build-version 24E263 \
--kernel-release 24.4.0 \
--kernel-version "Darwin Kernel Version 24.4.0: Fri Apr 11 18:32:50 PDT 2025; root:xnu-11417.101.15~117/RELEASE_ARM64_T6041" \
--machine arm64 \
--hw-model "MacBookAir10,1" \
--hw-machine arm64 \
--hw-memsize 17179869184 \
--enable-log \
--auto-product-name \
-- fastfetch
```

### å‘½ä»¤è¡Œé€‰é¡¹

ä»¥ä¸‹æ˜¯ `cli.sh` æ”¯æŒçš„æ‰€æœ‰é€‰é¡¹ï¼š

| é€‰é¡¹                   | æè¿°                               | çŽ¯å¢ƒå˜é‡                     |
| :--------------------- | :--------------------------------- | :--------------------------- |
| **ç³»ç»Ÿç‰ˆæœ¬** |                                    |                              |
| `--os-version VERSION` | è®¾ç½®å®Œæ•´ç‰ˆæœ¬å· (å¦‚: 15.4.1)        | `FAKE_OS_VERSION`            |
| `--os-major MAJOR`     | è®¾ç½®ä¸»ç‰ˆæœ¬å· (å¦‚: 15)              | `FAKE_OS_MAJOR`              |
| `--os-minor MINOR`     | è®¾ç½®æ¬¡ç‰ˆæœ¬å· (å¦‚: 4)               | `FAKE_OS_MINOR`              |
| `--os-patch PATCH`     | è®¾ç½®è¡¥ä¸ç‰ˆæœ¬å· (å¦‚: 1)             | `FAKE_OS_PATCH`              |
| `--build-version BUILD`| è®¾ç½®æž„å»ºç‰ˆæœ¬ (å¦‚: 24E263)          | `FAKE_OS_BUILD`              |
| **Darwin å†…æ ¸** |                                    |                              |
| `--kernel-release REL` | è®¾ç½®å†…æ ¸å‘å¸ƒç‰ˆæœ¬ (å¦‚: 24.4.0)      | `FAKE_KERNEL_RELEASE`        |
| `--kernel-version VER` | è®¾ç½®å®Œæ•´å†…æ ¸ç‰ˆæœ¬å­—ç¬¦ä¸²             | `FAKE_KERNEL_VERSION`        |
| **ç¡¬ä»¶æž¶æž„** |                                    |                              |
| `--machine ARCH`       | ä¿®æ”¹ `uname` è¿”å›žçš„æœºå™¨æž¶æž„        | `FAKE_MACHINE`               |
| **ç¡¬ä»¶ä¿¡æ¯** |                                    |                              |
| `--hw-model MODEL`     | ä¿®æ”¹ `sysctl` çš„ `hw.model` è¿”å›žå€¼ | `FAKE_HW_MODEL`              |
| `--hw-machine MACHINE` | ä¿®æ”¹ `sysctl` çš„ `hw.machine` è¿”å›žå€¼| `FAKE_HW_MACHINE`            |
| `--hw-memsize SIZE`    | è®¾ç½®å†…å­˜å¤§å° (å•ä½: å­—èŠ‚)          | `FAKE_HW_MEMSIZE`            |
| **åŠŸèƒ½å¼€å…³** |                                    |                              |
| `--enable-log`         | å¯ç”¨æ—¥å¿—è¾“å‡º (é»˜è®¤)                | `FAKE_ENABLE_LOG=1`          |
| `--disable-log`        | ç¦ç”¨æ—¥å¿—è¾“å‡º                       | `FAKE_ENABLE_LOG=0`          |
| `--auto-product-name`  | è‡ªåŠ¨åˆ¤æ–­äº§å“åç§° (é»˜è®¤)            | `FAKE_AUTO_PRODUCT_NAME=1`   |
| `--no-auto-product-name`| ç¦ç”¨è‡ªåŠ¨äº§å“åç§°åˆ¤æ–­               | `FAKE_AUTO_PRODUCT_NAME=0`   |
| **å…¶ä»–** |                                    |                              |
| `-h`, `--help`         | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯                       |                              |
| `--`                  | æ ‡è®°é€‰é¡¹ç»“æŸï¼ŒåŽé¢æ˜¯ç›®æ ‡ç¨‹åº       |                              |

**æ³¨æ„**: `machine` ä¸åŒäºŽ `hw-machine`ï¼Œå‰è€…ä¿®æ”¹ `uname` è¿”å›žå€¼ï¼ŒåŽè€… hook äº† `sysctl` çš„ `hw.machine` è¿”å›žå€¼ã€‚ åƒ `fastfetch` è¿™æ ·çš„å·¥å…·é€šå¸¸ä½¿ç”¨å‰è€…ã€‚

## âœ… å¦‚ä½•éªŒè¯

é¡¹ç›®å†…æä¾›äº†ä¸€ä¸ª `sysver` æµ‹è¯•ç¨‹åºï¼Œå®ƒå¯ä»¥ä»Žå¤šä¸ªå±‚é¢èŽ·å–ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€‚ ä½ å¯ä»¥ç”¨å®ƒæ¥éªŒè¯ä¼ªé€ æˆæžœã€‚

é¦–å…ˆï¼Œç¼–è¯‘æµ‹è¯•ç¨‹åºï¼š

```bash
clang++ -std=c++17 sysver.mm -framework Foundation -o sysver
```

ç„¶åŽï¼Œä¸ä½¿ç”¨ hook ç›´æŽ¥è¿è¡Œï¼ŒæŸ¥çœ‹çœŸå®žä¿¡æ¯ï¼š

```bash
./sysver
```

æŽ¥ç€ï¼Œä½¿ç”¨ `cli.sh` åŠ è½½ hook åŽè¿è¡Œï¼ŒæŸ¥çœ‹ä¼ªé€ ä¿¡æ¯ï¼š

```bash
./cli.sh --os-version 114.5.14 --build-version 1919810 -- ./sysver
```

é€šè¿‡å¯¹æ¯”ä¸¤æ¬¡çš„è¾“å‡ºï¼Œä½ å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ° `NSProcessInfo`, `sysctl`, å’Œ `uname` çš„è¿”å›žå€¼éƒ½å·²ç»è¢«æˆåŠŸä¿®æ”¹ã€‚
